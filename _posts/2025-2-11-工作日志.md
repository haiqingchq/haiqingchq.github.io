---
category: daily
layout: post_layout
title: 2.11工作日志
time: 2025年2月11日 星期二
location: 杭州
pulished: true
excerpt_separator: "#"
---

今天上午已经成功了的将minio的交付工具链出现的问题成功地解决了。下午要开始投入到新的工作中来了：erda统一鉴权重构

# erda统一鉴权

## 现在的问题

现在的erda项目中的runtime层，直接采用的是MVC的三层架构的模式。Endpoint -> Logic -> DB。处理起来的逻辑链路比较长。在Loigc层中每一个路由中，都要处理一遍鉴权和审计的逻辑。增加或者修改代码的复杂性比较高。



## 解决方案

将原来的Endpoint层和Logic层进行合并，将服务注册整合到erda-infra中进行操作。然后在拦截器中进行鉴权和审计。这样在erda中就相当于将Endpoint和Logic层合并了。只需要关注具体的业务逻辑。服务注册和鉴权和审计全都放到pb中完成。

> 虽然也可以在原来的代码上面直接写中间件的方式解决上述的问题。但是考虑到有现成的框架，就直接使用现成的框架来解决问题，而不是在现在的基础上面重新封装一个中间件的方式。可以保持整个项目的代码风格统一，解决方案的一致性。



## 实现

首先拿runtime开始做。

1、第一步：为Runtime的api定义protobuf，使用gohub生成相关的接口实现。

2、第二步：定义一个prodiver模块，来实现整个服务的注册，注册到一个http服务上面。

3、第三步：写好统一的鉴权和审计的中间件

4、第四步：将写好的模块加入到整个项目中。





