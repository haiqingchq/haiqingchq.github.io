---
category: daily
layout: post_layout
title: 2.12工作日志
time: 2025年2月12日 星期三
location: 杭州
pulished: true
excerpt_separator: "#"
---



由于在去年的时候已经熟悉过erda-infra框架，昨天下午也大概的了解了整个重构的需求和目的。今天开始编码。



# erda统一鉴权重构



## 编写proto文件

首先我针对路由，以及每个handlers的入参和返回值。编写proto文件。在编写的过程中遇到了一些问题。之前字节写项目的时候编写的proto文件，相对来说简单一些，没有遇到过一些复杂的类型。这次的编写过程中。遇到了一些阻碍。像interface，多重嵌套的结构体，自定义类型(string的枚举类型)



在我差不多写完80%的接口的时候，我遇到一个需要依赖其他proto文件的返回值类型。我问了一下我师兄如何处理。不问还好，一问才发现一个更大的问题。我发现这个模块之前已经部分重构过了的。我师兄说是之前的一个P8主管对这个模块，已经部分封装到了erda-infra的pb里面。但是还是没有做鉴权的。这下给我整懵逼了。



好吧，没有办法，毕竟是我的工作。那么现在开始整理一下，之前这位P8主管重构了一些什么内容，避免自己重构的代码和之前的发生冲突。



经过一番整理我发现一些问题，之前就重构了两个接口，增加了一个接口，问题是，之前重构的时候对变量的命名有自己的逻辑。比如在字段内容上，我使用的是snake_case，但是之前重构使用的是camel_case。其次是，我为了和未重构代码对应，在message的定义上以及函数名称的定义上，直接采用了和之前一样命名，但是在之前的重构上面，直接对message，函数名的相关命名进行了更新。



花了3个小时的时间，将enpoint里面的接口全都接到了erda-infra里面去了。还有几个问题需要解决

- 有四个接口公用两个接口函数，没遇到过这种情况，明天看看怎么做。
- 还有一个函数的返回值涉及到了核心的内容，直接重构涉及到的范围非常广，可能会引入前端。师兄的意思是先重构相对简单的接口，这个接口后面再来处理。
- 有一个接口的返回值涉及到了release模块的proto文件的定义，暂时还没有做。



